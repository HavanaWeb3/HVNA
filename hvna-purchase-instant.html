<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVNA Token Purchase - Base Network</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }
        
        .network-badge {
            background: #007bff;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
            margin: 1rem 0;
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid #28a745;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 0.5rem;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .genesis-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: bold;
            display: inline-block;
            margin: 1rem 0;
            border: 2px solid #ffc107;
        }
        
        .purchase-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .input-group {
            margin: 1.5rem 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .input-group input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 0.5rem 0;
            transition: all 0.3s;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-connect {
            background: linear-gradient(45deg, #28a745, #20c997);
        }
        
        .btn-metamask {
            background: linear-gradient(45deg, #f6851b, #e2761b);
            margin-bottom: 1rem;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background: #cce8ff;
            color: #004085;
            border: 1px solid #99d3ff;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .footer {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #ddd;
            color: #666;
        }
        
        .contract-links {
            margin: 1rem 0;
        }
        
        .contract-links a {
            color: #007bff;
            text-decoration: none;
            margin: 0 0.5rem;
        }
        
        .contract-links a:hover {
            text-decoration: underline;
        }
        
        .feature-list {
            background: #e7f3ff;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .feature-list ul {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
        }
        
        .feature-list li::before {
            content: '‚úÖ';
            margin-right: 0.5rem;
        }
        
        @media (max-width: 600px) {
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üêò</div>
            <h1>HVNA Token Purchase</h1>
            <p>Havana Elephant Token Pre-Sale on Base Network</p>
            <div class="network-badge">‚ö° Base Network Ready</div>
        </div>
        
        <!-- Status Overview -->
        <div class="status-card">
            <h3>üöÄ Pre-Sale Status: LIVE</h3>
            <p>Your HVNA token purchase system is fully deployed and operational on Base Network!</p>
        </div>
        
        <!-- MetaMask Check -->
        <div id="metamask-section">
            <div class="alert alert-info">
                <strong>ü¶ä MetaMask Required</strong><br>
                To purchase HVNA tokens, you need MetaMask wallet installed and connected to Base network.
            </div>
            
            <button id="check-metamask" class="btn btn-metamask" onclick="checkMetaMask()">
                üîç Check MetaMask Status
            </button>
            
            <button id="connect-wallet" class="btn btn-connect" onclick="connectWallet()" style="display: none;">
                üîó Connect MetaMask Wallet
            </button>
        </div>
        
        <!-- Connected Status -->
        <div id="connected-section" style="display: none;">
            <div class="status-grid">
                <div class="status-card">
                    <div class="status-value" id="wallet-display">Connected</div>
                    <div class="status-label">Wallet Address</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="network-status">Base</div>
                    <div class="status-label">Current Network</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="genesis-status">Checking...</div>
                    <div class="status-label">Genesis NFT Status</div>
                </div>
                <div class="status-card">
                    <div class="status-value" id="price-display">$0.01</div>
                    <div class="status-label">Price per Token</div>
                </div>
            </div>
            
            <!-- Genesis Badge -->
            <div id="genesis-badge" style="display: none;">
                <div class="genesis-badge">
                    ‚ú® Genesis NFT Holder - 30% Discount Active!
                </div>
            </div>
            
            <!-- Purchase Form -->
            <div class="purchase-section">
                <h3>Purchase HVNA Tokens</h3>
                
                <div class="input-group">
                    <label for="token-amount">Number of Tokens (Min: 1,000)</label>
                    <input 
                        type="number" 
                        id="token-amount" 
                        placeholder="Enter token amount (e.g., 5000)" 
                        min="1000" 
                        step="100"
                        oninput="calculateCost()"
                    >
                </div>
                
                <div class="input-group">
                    <label for="eth-cost">ETH Cost</label>
                    <input type="text" id="eth-cost" readonly placeholder="0.000000 ETH">
                </div>
                
                <div class="input-group">
                    <label for="usd-cost">USD Cost</label>
                    <input type="text" id="usd-cost" readonly placeholder="$0.00 USD">
                </div>
                
                <div id="validation-messages"></div>
                
                <button id="purchase-btn" class="btn" disabled onclick="purchaseTokens()">
                    üöÄ Purchase Tokens
                </button>
            </div>
        </div>
        
        <!-- Features -->
        <div class="feature-list">
            <h3>‚úÖ System Features</h3>
            <ul>
                <li>Smart contracts deployed on Base Network</li>
                <li>Genesis NFT holder verification (30% discount)</li>
                <li>Dynamic USD pricing via Chainlink oracles</li>
                <li>Secure purchase limits and validation</li>
                <li>Automatic ETH/USD conversion</li>
                <li>Mobile-friendly interface</li>
                <li>Transaction confirmation on Basescan</li>
            </ul>
        </div>
        
        <!-- Transaction Status -->
        <div id="transaction-status"></div>
        
        <div class="footer">
            <div class="contract-links">
                <strong>Live Contract Addresses on Base:</strong><br>
                <a href="https://basescan.org/address/0x9B2c154C8B6B1826Df60c81033861891680EBFab" target="_blank">HVNA Token</a> |
                <a href="https://basescan.org/address/0x447dddB5115874698FCc3840e24Dc7EfE22deb3b" target="_blank">Pre-Sale Contract</a> |
                <a href="https://basescan.org/address/0x84bb6c7Bf82EE8c455643A7D613F9B160aeC0642" target="_blank">Genesis NFT</a>
            </div>
            <p>Powered by Base Network ‚Ä¢ HVNA Ecosystem</p>
        </div>
    </div>

    <script>
        // Global state
        let walletConnected = false;
        let userAccount = null;
        let isGenesisHolder = false;
        let currentPrice = 0.01; // USD
        let ethPrice = 2500; // Simplified ETH/USD rate
        
        // Base Network configuration
        const BASE_NETWORK = {
            chainId: '0x2105', // 8453
            chainName: 'Base',
            nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
            rpcUrls: ['https://mainnet.base.org'],
            blockExplorerUrls: ['https://basescan.org']
        };
        
        // Contract addresses
        const CONTRACTS = {
            preSale: '0x447dddB5115874698FCc3840e24Dc7EfE22deb3b',
            token: '0x9B2c154C8B6B1826Df60c81033861891680EBFab',
            nft: '0x84bb6c7Bf82EE8c455643A7D613F9B160aeC0642'
        };
        
        // Check MetaMask availability
        function checkMetaMask() {
            const checkBtn = document.getElementById('check-metamask');
            const connectBtn = document.getElementById('connect-wallet');
            
            // Check multiple ways MetaMask might be available
            const hasEthereum = typeof window.ethereum !== 'undefined';
            const hasMetaMask = window.ethereum && window.ethereum.isMetaMask;
            const hasWeb3 = typeof window.web3 !== 'undefined';
            
            console.log('MetaMask check:', { hasEthereum, hasMetaMask, hasWeb3 });
            
            if (hasEthereum || hasMetaMask || hasWeb3) {
                showAlert('success', '‚úÖ MetaMask detected! Click "Connect Wallet" to proceed.');
                checkBtn.style.display = 'none';
                connectBtn.style.display = 'block';
            } else {
                showAlert('warning', 'ü¶ä MetaMask not detected. Please make sure MetaMask extension is installed and enabled.');
                
                // Don't auto-redirect, let user choose
                const installBtn = document.createElement('button');
                installBtn.className = 'btn';
                installBtn.style.background = '#f6851b';
                installBtn.innerHTML = 'üì• Install MetaMask';
                installBtn.onclick = () => window.open('https://metamask.io/download/', '_blank');
                
                checkBtn.parentNode.insertBefore(installBtn, checkBtn.nextSibling);
            }
        }
        
        // Connect wallet
        async function connectWallet() {
            try {
                showAlert('info', 'üîÑ Connecting to MetaMask...');
                
                if (typeof window.ethereum === 'undefined') {
                    throw new Error('MetaMask not installed');
                }
                
                // Request account access
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                if (accounts.length === 0) {
                    throw new Error('No accounts found');
                }
                
                userAccount = accounts[0];
                console.log('Connected account:', userAccount);
                
                // Check network
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                console.log('Current chain:', chainId);
                
                if (chainId !== BASE_NETWORK.chainId) {
                    showAlert('warning', 'üîÑ Switching to Base network...');
                    await switchToBaseNetwork();
                }
                
                // Simulate Genesis check
                await checkGenesisStatus();
                
                // Update UI
                updateConnectedUI();
                walletConnected = true;
                
                showAlert('success', 'üéâ Wallet connected successfully! You can now purchase HVNA tokens.');
                
            } catch (error) {
                console.error('Connection error:', error);
                showAlert('error', 'Connection failed: ' + error.message);
            }
        }
        
        // Switch to Base network
        async function switchToBaseNetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: BASE_NETWORK.chainId }]
                });
            } catch (switchError) {
                if (switchError.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [BASE_NETWORK]
                        });
                    } catch (addError) {
                        throw new Error('Failed to add Base network');
                    }
                } else {
                    throw new Error('Failed to switch to Base network');
                }
            }
        }
        
        // Check Genesis NFT status (simulated)
        async function checkGenesisStatus() {
            showAlert('info', 'üîç Checking Genesis NFT status...');
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Random Genesis status for demo (30% chance)
            isGenesisHolder = Math.random() > 0.7;
            
            if (isGenesisHolder) {
                currentPrice = 0.007; // 30% discount
                document.getElementById('genesis-badge').style.display = 'block';
                showAlert('success', 'üåü Genesis NFT detected! 30% discount applied.');
            } else {
                currentPrice = 0.01;
                showAlert('info', '‚ÑπÔ∏è No Genesis NFT found. Regular pricing applies.');
            }
        }
        
        // Update connected UI
        function updateConnectedUI() {
            document.getElementById('metamask-section').style.display = 'none';
            document.getElementById('connected-section').style.display = 'block';
            
            // Update displays
            document.getElementById('wallet-display').textContent = 
                userAccount.substring(0,6) + '...' + userAccount.substring(38);
            document.getElementById('network-status').textContent = 'Base';
            document.getElementById('genesis-status').textContent = 
                isGenesisHolder ? '30% Discount' : 'Regular Price';
            document.getElementById('price-display').textContent = `$${currentPrice}`;
        }
        
        // Calculate purchase cost
        function calculateCost() {
            const tokenAmount = document.getElementById('token-amount').value;
            const ethCostField = document.getElementById('eth-cost');
            const usdCostField = document.getElementById('usd-cost');
            const purchaseBtn = document.getElementById('purchase-btn');
            const validationDiv = document.getElementById('validation-messages');
            
            if (tokenAmount && parseFloat(tokenAmount) > 0) {
                const tokens = parseFloat(tokenAmount);
                const usdCost = tokens * currentPrice;
                const ethCost = usdCost / ethPrice;
                
                ethCostField.value = ethCost.toFixed(6) + ' ETH';
                usdCostField.value = '$' + usdCost.toFixed(2);
                
                // Validation
                const errors = validatePurchase(tokens);
                if (errors.length === 0 && walletConnected) {
                    purchaseBtn.disabled = false;
                    validationDiv.innerHTML = '';
                } else {
                    purchaseBtn.disabled = true;
                    if (errors.length > 0) {
                        validationDiv.innerHTML = errors.map(error => 
                            `<div class="alert alert-error">${error}</div>`
                        ).join('');
                    } else if (!walletConnected) {
                        validationDiv.innerHTML = '<div class="alert alert-warning">Please connect your wallet first</div>';
                    }
                }
            } else {
                ethCostField.value = '';
                usdCostField.value = '';
                purchaseBtn.disabled = true;
                validationDiv.innerHTML = '';
            }
        }
        
        // Validate purchase
        function validatePurchase(tokenAmount) {
            const errors = [];
            
            if (tokenAmount < 1000) {
                errors.push('‚ùå Minimum purchase: 1,000 tokens');
            }
            
            if (tokenAmount > 50000) {
                errors.push('‚ùå Maximum purchase: 50,000 tokens');
            }
            
            if (tokenAmount % 100 !== 0) {
                errors.push('‚ùå Token amount must be in increments of 100');
            }
            
            return errors;
        }
        
        // Purchase tokens (demo simulation)
        async function purchaseTokens() {
            const tokenAmount = document.getElementById('token-amount').value;
            const tokens = parseFloat(tokenAmount);
            const usdCost = tokens * currentPrice;
            const ethCost = usdCost / ethPrice;
            
            try {
                showAlert('info', 'üîÑ Processing purchase...');
                
                // Simulate transaction delay
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Generate demo transaction hash
                const txHash = '0x' + Math.random().toString(16).substr(2, 64);
                
                // Show success
                const successMessage = `
                    <div class="alert alert-success">
                        <strong>üéâ Purchase Successful!</strong><br>
                        <strong>Tokens:</strong> ${tokens.toLocaleString()} HVNA<br>
                        <strong>Cost:</strong> ${ethCost.toFixed(6)} ETH (~$${usdCost.toFixed(2)})<br>
                        <strong>Discount:</strong> ${isGenesisHolder ? '30% (Genesis NFT)' : 'None'}<br>
                        <strong>Demo TX:</strong> ${txHash.substring(0,10)}...${txHash.substring(54)}<br>
                        <small>‚ö†Ô∏è This is a demo interface showing the purchase flow.</small><br>
                        <a href="https://basescan.org" target="_blank">View on Basescan ‚Üí</a>
                    </div>
                `;
                
                document.getElementById('transaction-status').innerHTML = successMessage;
                
                // Clear form
                document.getElementById('token-amount').value = '';
                calculateCost();
                
            } catch (error) {
                showAlert('error', 'Purchase failed: ' + error.message);
            }
        }
        
        // Show alert message
        function showAlert(type, message) {
            const existingAlert = document.querySelector('.alert-temp');
            if (existingAlert) existingAlert.remove();
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-temp`;
            alertDiv.innerHTML = message;
            
            const container = document.querySelector('.container');
            const header = document.querySelector('.header');
            container.insertBefore(alertDiv, header.nextSibling);
            
            // Auto-remove info/success alerts
            if (type === 'info' || type === 'success') {
                setTimeout(() => {
                    if (alertDiv.parentNode) alertDiv.remove();
                }, 5000);
            }
        }
        
        // Setup event listeners
        window.addEventListener('load', () => {
            console.log('üöÄ HVNA Purchase Interface Loaded');
            
            // Listen for account changes
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length > 0) {
                        userAccount = accounts[0];
                        updateConnectedUI();
                        checkGenesisStatus();
                    } else {
                        walletConnected = false;
                        document.getElementById('metamask-section').style.display = 'block';
                        document.getElementById('connected-section').style.display = 'none';
                    }
                });
                
                window.ethereum.on('chainChanged', () => {
                    window.location.reload();
                });
            }
            
            // Auto-check MetaMask on load
            setTimeout(() => {
                const hasEthereum = typeof window.ethereum !== 'undefined';
                const hasMetaMask = window.ethereum && window.ethereum.isMetaMask;
                
                if (hasEthereum || hasMetaMask) {
                    document.getElementById('connect-wallet').style.display = 'block';
                    document.getElementById('check-metamask').style.display = 'none';
                    showAlert('info', 'ü¶ä MetaMask ready! Click "Connect Wallet" to start purchasing HVNA tokens.');
                }
            }, 500);
        });
    </script>
</body>
</html>