"use strict";(()=>{var e={};e.id=990,e.ids=[990],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},20916:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>N,patchFetch:()=>f,requestAsyncStorage:()=>x,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>y});var t={};r.r(t),r.d(t,{DELETE:()=>c,GET:()=>m,POST:()=>d,PUT:()=>g});var a=r(49303),o=r(88716),n=r(60670),i=r(87070),l=r(75571),u=r(8194),p=r(95456);async function d(e){try{let s=await (0,l.getServerSession)(p.L);if(!s||!s.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{title:r,content:t,imageUrl:a}=await e.json();if(!t?.trim())return i.NextResponse.json({error:"Content is required"},{status:400});console.log("\uD83D\uDCDD Post creation debug:"),console.log("- Title:",r),console.log("- Content:",t?.substring(0,50)+"..."),console.log("- Image URL:",a),console.log("- Author ID:",s.user.id);let o=await u._.post.create({data:{title:r?.trim()||null,content:t.trim(),imageUrl:a||null,authorId:s.user.id},include:{author:{select:{username:!0,displayName:!0}}}});return i.NextResponse.json({post:o},{status:201})}catch(e){return console.error("Error creating post:",e),i.NextResponse.json({error:"Failed to create post"},{status:500})}}async function m(e){try{let s=new URL(e.url),r=s.searchParams.get("userId"),t=parseInt(s.searchParams.get("limit")||"10"),a=await u._.post.findMany({where:r?{authorId:r}:{},include:{author:{select:{username:!0,displayName:!0}}},orderBy:{createdAt:"desc"},take:t});return i.NextResponse.json({posts:a})}catch(e){return console.error("Error fetching posts:",e),i.NextResponse.json({error:"Failed to fetch posts"},{status:500})}}async function c(e){try{let s=await (0,l.getServerSession)(p.L);if(!s||!s.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=new URL(e.url).searchParams.get("postId");if(!r)return i.NextResponse.json({error:"Post ID is required"},{status:400});let t=await u._.post.findUnique({where:{id:r}});if(!t)return i.NextResponse.json({error:"Post not found"},{status:404});if(t.authorId!==s.user.id)return i.NextResponse.json({error:"Unauthorized to delete this post"},{status:403});return await u._.post.delete({where:{id:r}}),console.log("\uD83D\uDDD1️ Post deleted:",r),i.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting post:",e),i.NextResponse.json({error:"Failed to delete post"},{status:500})}}async function g(e){try{let s=await (0,l.getServerSession)(p.L);if(!s||!s.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{postId:r,title:t,content:a,imageUrl:o}=await e.json();if(!r)return i.NextResponse.json({error:"Post ID is required"},{status:400});if(!a?.trim())return i.NextResponse.json({error:"Content is required"},{status:400});let n=await u._.post.findUnique({where:{id:r}});if(!n)return i.NextResponse.json({error:"Post not found"},{status:404});if(n.authorId!==s.user.id)return i.NextResponse.json({error:"Unauthorized to edit this post"},{status:403});console.log("✏️ Post edit debug:"),console.log("- Post ID:",r),console.log("- New Title:",t),console.log("- New Content:",a?.substring(0,50)+"..."),console.log("- New Image URL:",o);let d=await u._.post.update({where:{id:r},data:{title:t?.trim()||null,content:a.trim(),imageUrl:o||n.imageUrl},include:{author:{select:{username:!0,displayName:!0}}}});return i.NextResponse.json({post:d})}catch(e){return console.error("Error updating post:",e),i.NextResponse.json({error:"Failed to update post"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/posts/route",pathname:"/api/posts",filename:"route",bundlePath:"app/api/posts/route"},resolvedPagePath:"/Users/davidsime/hvna-ecosystem/contentlynk/src/app/api/posts/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:x,staticGenerationAsyncStorage:y,serverHooks:w}=h,N="/api/posts/route";function f(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:y})}},95456:(e,s,r)=>{r.d(s,{L:()=>d});var t=r(13539),a=r(53797),o=r(8194),n=r(42023),i=r.n(n),l=r(91585);let u=l.Ry({email:l.Z_().email(),password:l.Z_().min(6)}),p=l.Ry({email:l.Z_().email(),username:l.Z_().min(3).max(20).regex(/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, underscores, and hyphens"),password:l.Z_().min(6),displayName:l.Z_().optional()}),d={adapter:(0,t.N)(o._),providers:[(0,a.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"},username:{label:"Username",type:"text"},displayName:{label:"Display Name",type:"text"},isRegister:{label:"Is Register",type:"text"}},async authorize(e){if(!e?.email||!e?.password)return null;try{if("true"===e.isRegister){console.log("Registration attempt:",{email:e.email,username:e.username,displayName:e.displayName});let s=p.parse({email:e.email,username:e.username,password:e.password,displayName:e.displayName});console.log("Validation passed:",s);let r=await o._.user.findFirst({where:{OR:[{email:s.email},{username:s.username}]}});if(console.log("Existing user check:",r),r)throw console.log("User already exists:",r.email,r.username),Error("User already exists with this email or username");await i().hash(s.password,12);let t=await o._.user.create({data:{email:s.email,username:s.username,displayName:s.displayName||s.username}});return{id:t.id,email:t.email,username:t.username,displayName:t.displayName||void 0}}{let s=u.parse({email:e.email,password:e.password}),r=await o._.user.findUnique({where:{email:s.email}});if(!r)return null;return{id:r.id,email:r.email,username:r.username,displayName:r.displayName||void 0}}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:s})=>(s&&(e.username=s.username,e.displayName=s.displayName),e),session:async({session:e,token:s})=>(s&&(e.user.id=s.sub,e.user.username=s.username,e.user.displayName=s.displayName),e)},pages:{signIn:"/auth/signin"}}},8194:(e,s,r)=>{r.d(s,{_:()=>a});let t=require("@prisma/client"),a=globalThis.prisma??new t.PrismaClient}};var s=require("../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[276,834,70],()=>r(20916));module.exports=t})();