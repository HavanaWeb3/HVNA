(()=>{var e={};e.id=998,e.ids=[998],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},63477:e=>{"use strict";e.exports=require("querystring")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},22122:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>eg,patchFetch:()=>ew,requestAsyncStorage:()=>eh,routeModule:()=>ef,serverHooks:()=>eb,staticGenerationAsyncStorage:()=>ey});var o,n,a,s={};r.r(s),r.d(s,{POST:()=>em});var i=r(49303),l=r(88716),u=r(60670),c=r(87070),p=r(75571),d=r(95456);let m=require("stream");var f=r(40346),h=r(42579);let y=require("undici");var b=r(49752),g=new Promise(e=>{try{let t=new Uint8Array([104,101,108,108,111]);new Blob([t]).text().then(t=>{e("hello"===t)}).catch(()=>{e(!1)})}catch{e(!1)}});async function w(e){let t;return e instanceof ReadableStream?e:e instanceof Blob?e.stream():_(e)?m.Readable.toWeb(e):(t=e instanceof ArrayBuffer?new Uint8Array(e):f(e)?e:new TextEncoder().encode(e),await g)?new Blob([t]).stream():new ReadableStream({start(e){e.enqueue(t),e.close()}})}function _(e){return"object"==typeof e&&"function"==typeof e.pipe&&e.readable&&"function"==typeof e._read&&"object"==typeof e._readableState}var v=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i,x={b:1,kb:1024,mb:1048576,gb:1073741824,tb:1099511627776,pb:0x4000000000000};function T(e){let t;if("number"==typeof e&&!isNaN(e))return e;if("string"!=typeof e)return null;let r=v.exec(e),o="b";if(r){let[,e,,,n]=r;if(!e)return null;t=parseFloat(e),n&&(o=n.toLowerCase())}else t=parseInt(e,10);return isNaN(t)?null:Math.floor(x[o]*t)}var R=class extends Error{constructor(e){super(`Vercel Blob: ${e}`)}},E=["//"],O=(()=>{if(function(){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product)return!0;if("undefined"!=typeof process){let e=process.type;return"renderer"!==e&&"worker"!==e&&!!(process.versions&&process.versions.node)}return!1}())return!0;if(N().startsWith("http://localhost"))return!1;let e=!1,t=new Request(N(),{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})();function N(e=""){let t=null;try{t=process.env.VERCEL_BLOB_API_URL||process.env.NEXT_PUBLIC_VERCEL_BLOB_API_URL}catch{}return`${t||"https://vercel.com/api/blob"}${e}`}var L="function"==typeof TextEncoder?new TextEncoder:null;function P(e){return e?"string"==typeof e?L?L.encode(e).byteLength:new Blob([e]).size:"byteLength"in e&&"number"==typeof e.byteLength?e.byteLength:"size"in e&&"number"==typeof e.size?e.size:0:0}var S=(e,t)=>{let r=new Uint8Array(0);return new TransformStream({transform(o,n){queueMicrotask(()=>{let a=new Uint8Array(r.length+o.byteLength);for(a.set(r),a.set(new Uint8Array(o),r.length),r=a;r.length>=e;){let o=r.slice(0,e);n.enqueue(o),null==t||t(o.byteLength),r=r.slice(e)}})},flush(e){queueMicrotask(()=>{r.length>0&&(e.enqueue(r),null==t||t(r.byteLength))})}})};function U(e){return globalThis.ReadableStream&&e instanceof ReadableStream}var A=Object.prototype.toString,B=e=>"[object Error]"===A.call(e),k=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]),I=!1;try{((null==(o=process.env.DEBUG)?void 0:o.includes("blob"))||(null==(n=process.env.NEXT_PUBLIC_DEBUG)?void 0:n.includes("blob")))&&(I=!0)}catch(e){}function C(e,...t){I&&console.debug(`vercel-blob: ${e}`,...t)}var q="function"==typeof y.fetch,$=q&&O,M=async({input:e,init:t,onUploadProgress:r})=>{let o;if(C("using fetch"),t.body){if(r){let e=await w(t.body),n=0,a=S(65536,e=>{r(n+=e)});o=e.pipeThrough(a)}else o=t.body}let n=O&&o&&function(e){return!!(U(e)||_(e))}(o)?"half":void 0;return(0,y.fetch)(e,{...t,...t.body?{body:o}:{},duplex:n})},j="undefined"!=typeof XMLHttpRequest,D=async({input:e,init:t,onUploadProgress:r})=>{C("using xhr");let o=null;return t.body&&(o=U(t.body)?await new Response(t.body).blob():t.body),new Promise((n,a)=>{let s=new XMLHttpRequest;if(s.open(t.method||"GET",e.toString(),!0),r&&s.upload.addEventListener("progress",e=>{e.lengthComputable&&r(e.loaded)}),s.onload=()=>{var e;if(null==(e=t.signal)?void 0:e.aborted){a(new DOMException("The user aborted the request.","AbortError"));return}let r=new Headers;s.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(e=>{let t=e.split(": "),o=t.shift(),n=t.join(": ");o&&r.set(o.toLowerCase(),n)}),n(new Response(s.response,{status:s.status,statusText:s.statusText,headers:r}))},s.onerror=()=>{a(TypeError("Network request failed"))},s.ontimeout=()=>{a(TypeError("Network request timed out"))},s.onabort=()=>{a(new DOMException("The user aborted a request.","AbortError"))},t.headers&&new Headers(t.headers).forEach((e,t)=>{s.setRequestHeader(t,e)}),t.signal&&(t.signal.addEventListener("abort",()=>{s.abort()}),t.signal.aborted)){s.abort();return}s.send(o)})},V=async({input:e,init:t,onUploadProgress:r})=>{if(r){if($)return M({input:e,init:t,onUploadProgress:r});if(j)return D({input:e,init:t,onUploadProgress:r})}if(q)return M({input:e,init:t});if(j)return D({input:e,init:t});throw Error("No request implementation available")},z=null!=(a=globalThis.DOMException)?a:(()=>{try{atob("~")}catch(e){return Object.getPrototypeOf(e).constructor}})(),H=class extends R{constructor(){super("Access denied, please provide a valid token for this resource.")}},F=class extends R{constructor(e){super(`Content type mismatch, ${e}.`)}},X=class extends R{constructor(e){super(`Pathname mismatch, ${e}. Check the pathname used in upload() or put() matches the one from the client token.`)}},G=class extends R{constructor(){super("Client token has expired.")}},Z=class extends R{constructor(e){super(`File is too large, ${e}.`)}},W=class extends R{constructor(){super("This store does not exist.")}},Y=class extends R{constructor(){super("This store has been suspended.")}},J=class extends R{constructor(){super("Unknown error, please visit https://vercel.com/help.")}},K=class extends R{constructor(){super("The requested blob does not exist")}},Q=class extends R{constructor(){super("The blob service is currently not available. Please try again.")}},ee=class extends R{constructor(e){super(`Too many requests please lower the number of concurrent requests ${e?` - try again in ${e} seconds`:""}.`),this.retryAfter=null!=e?e:0}},et=class extends R{constructor(){super("The request was aborted.")}};async function er(e){var t,r,o;let n,a,s;try{let s=await e.json();n=null!=(r=null==(t=s.error)?void 0:t.code)?r:"unknown_error",a=null==(o=s.error)?void 0:o.message}catch{n="unknown_error"}switch((null==a?void 0:a.includes("contentType"))&&a.includes("is not allowed")&&(n="content_type_not_allowed"),(null==a?void 0:a.includes('"pathname"'))&&a.includes("does not match the token payload")&&(n="client_token_pathname_mismatch"),"Token expired"===a&&(n="client_token_expired"),(null==a?void 0:a.includes("the file length cannot be greater than"))&&(n="file_too_large"),n){case"store_suspended":s=new Y;break;case"forbidden":s=new H;break;case"content_type_not_allowed":s=new F(a);break;case"client_token_pathname_mismatch":s=new X(a);break;case"client_token_expired":s=new G;break;case"file_too_large":s=new Z(a);break;case"not_found":s=new K;break;case"store_not_found":s=new W;break;case"bad_request":s=new R(null!=a?a:"Bad request");break;case"service_unavailable":s=new Q;break;case"rate_limited":s=function(e){let t=e.headers.get("retry-after");return new ee(t?parseInt(t,10):void 0)}(e);break;default:s=new J}return{code:n,error:s}}async function eo(e,t,r){let o=function(){let e=null;try{e=process.env.VERCEL_BLOB_API_VERSION_OVERRIDE||process.env.NEXT_PUBLIC_VERCEL_BLOB_API_VERSION_OVERRIDE}catch{}return`${null!=e?e:11}`}(),n=function(e){if(null==e?void 0:e.token)return e.token;if(process.env.BLOB_READ_WRITE_TOKEN)return process.env.BLOB_READ_WRITE_TOKEN;throw new R("No token found. Either configure the `BLOB_READ_WRITE_TOKEN` environment variable, or pass a `token` option to your calls.")}(r),a=function(){let e={};try{"VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API"in process.env&&void 0!==process.env.VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API?e["x-proxy-through-alternative-api"]=process.env.VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API:"NEXT_PUBLIC_VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API"in process.env&&void 0!==process.env.NEXT_PUBLIC_VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API&&(e["x-proxy-through-alternative-api"]=process.env.NEXT_PUBLIC_VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API)}catch{}return e}(),[,,,s=""]=n.split("_"),i=`${s}:${Date.now()}:${Math.random().toString(16).slice(2)}`,l=0,u=0,c=0,p=(null==r?void 0:r.onUploadProgress)||function(){try{return"1"===process.env.VERCEL_BLOB_USE_X_CONTENT_LENGTH}catch{return!1}}();t.body&&p&&(u=P(t.body)),(null==r?void 0:r.onUploadProgress)&&r.onUploadProgress({loaded:0,total:u,percentage:0});let d=await h(async s=>{let d;try{d=await V({input:N(e),init:{...t,headers:{"x-api-blob-request-id":i,"x-api-blob-request-attempt":String(l),"x-api-version":o,...p?{"x-content-length":String(u)}:{},authorization:`Bearer ${n}`,...a,...t.headers}},onUploadProgress:(null==r?void 0:r.onUploadProgress)?e=>{var t;let o=0!==u?u:e;c=e;let n=u>0?Number((e/o*100).toFixed(2)):0;100===n&&u>0||null==(t=r.onUploadProgress)||t.call(r,{loaded:e,total:o,percentage:n})}:void 0})}catch(e){if(e instanceof z&&"AbortError"===e.name){s(new et);return}if(e&&B(e)&&"TypeError"===e.name&&"string"==typeof e.message&&("Load failed"===e.message?void 0===e.stack:k.has(e.message)))throw e;if(e instanceof TypeError){s(e);return}throw e}if(d.ok)return d;let{code:m,error:f}=await er(d);if("unknown_error"===m||"service_unavailable"===m||"internal_server_error"===m)throw f;s(f)},{retries:function(){try{let e=process.env.VERCEL_BLOB_RETRIES||"10";return parseInt(e,10)}catch{return 10}}(),onRetry:t=>{t instanceof Error&&C(`retrying API request to ${e}`,t.message),l+=1}});if(!d)throw new J;return(null==r?void 0:r.onUploadProgress)&&r.onUploadProgress({loaded:c,total:c,percentage:100}),await d.json()}var en={cacheControlMaxAge:"x-cache-control-max-age",addRandomSuffix:"x-add-random-suffix",allowOverwrite:"x-allow-overwrite",contentType:"x-content-type"};async function ea({pathname:e,options:t,extraChecks:r,getToken:o}){if(!e)throw new R("pathname is required");if(e.length>950)throw new R("pathname is too long, maximum length is 950");for(let t of E)if(e.includes(t))throw new R(`pathname cannot contain "${t}", please encode it if needed`);if(!t)throw new R("missing options, see usage");if("public"!==t.access)throw new R('access must be "public"');return r&&r(t),o&&(t.token=await o(e,t)),t}async function es({uploadId:e,key:t,pathname:r,parts:o,headers:n,options:a}){let s=new URLSearchParams({pathname:r});try{let r=await eo(`/mpu?${s.toString()}`,{method:"POST",headers:{...n,"content-type":"application/json","x-mpu-action":"complete","x-mpu-upload-id":e,"x-mpu-key":encodeURIComponent(t)},body:JSON.stringify(o),signal:a.abortSignal},a);return C("mpu: complete",r),r}catch(e){if(e instanceof TypeError&&("Failed to fetch"===e.message||"fetch failed"===e.message))throw new Q;throw e}}async function ei(e,t,r){C("mpu: create","pathname:",e);let o=new URLSearchParams({pathname:e});try{let e=await eo(`/mpu?${o.toString()}`,{method:"POST",headers:{...t,"x-mpu-action":"create"},signal:r.abortSignal},r);return C("mpu: create",e),e}catch(e){if(e instanceof TypeError&&("Failed to fetch"===e.message||"fetch failed"===e.message))throw new Q;throw e}}async function el({uploadId:e,key:t,pathname:r,headers:o,options:n,internalAbortController:a=new AbortController,part:s}){var i,l,u;let c=new URLSearchParams({pathname:r}),p=eo(`/mpu?${c.toString()}`,{signal:a.signal,method:"POST",headers:{...o,"x-mpu-action":"upload","x-mpu-key":encodeURIComponent(t),"x-mpu-upload-id":e,"x-mpu-part-number":s.partNumber.toString()},body:s.blob},n);function d(){a.abort()}(null==(i=n.abortSignal)?void 0:i.aborted)?d():null==(l=n.abortSignal)||l.addEventListener("abort",d);let m=await p;return null==(u=n.abortSignal)||u.removeEventListener("abort",d),m}var eu="undefined"!=typeof window?6:8,ec=16777216*eu;async function ep(e,t,r,o){C("mpu: init","pathname:",e,"headers:",r);let n={...o,onUploadProgress:void 0},a=await ei(e,r,n),s=P(t),i=await w(t),l=await function({uploadId:e,key:t,pathname:r,stream:o,headers:n,options:a,totalToLoad:s}){C("mpu: upload init","key:",t);let i=new AbortController;return new Promise((l,u)=>{let c;let p=[],d=[],m=o.getReader(),f=0,h=!1,y=1,g=!1,w=0,_=!1,v=0,x=[],R=0,E={};async function O(){for(C("mpu: upload read start","activeUploads:",f,"currentBytesInMemory:",`${T(w)}/${T(ec)}`,"bytesSent:",T(v)),h=!0;w<ec&&!g;)try{let{value:e,done:t}=await m.read();if(t){_=!0,C("mpu: upload read consumed the whole stream"),x.length>0&&(p.push({partNumber:y++,blob:new Blob(x,{type:"application/octet-stream"})}),L()),h=!1;return}w+=e.byteLength;let r=0;for(;r<e.byteLength;){let t=8388608-R,o=Math.min(r+t,e.byteLength),n=e.slice(r,o);x.push(n),R+=n.byteLength,r=o,8388608===R&&(p.push({partNumber:y++,blob:new Blob(x,{type:"application/octet-stream"})}),x=[],R=0,L())}}catch(e){P(e)}C("mpu: upload read end","activeUploads:",f,"currentBytesInMemory:",`${T(w)}/${T(ec)}`,"bytesSent:",T(v)),h=!1}async function N(o){f++,C("mpu: upload send part start","partNumber:",o.partNumber,"size:",o.blob.size,"activeUploads:",f,"currentBytesInMemory:",`${T(w)}/${T(ec)}`,"bytesSent:",T(v));try{let s=a.onUploadProgress?e=>{E[o.partNumber]=e.loaded,c&&c()}:void 0,u=await el({uploadId:e,key:t,pathname:r,headers:n,options:{...a,onUploadProgress:s},internalAbortController:i,part:o});if(C("mpu: upload send part end","partNumber:",o.partNumber,"activeUploads",f,"currentBytesInMemory:",`${T(w)}/${T(ec)}`,"bytesSent:",T(v)),g)return;if(d.push({partNumber:o.partNumber,etag:u.etag}),w-=o.blob.size,f--,v+=o.blob.size,p.length>0&&L(),_){0===f&&(m.releaseLock(),l(d));return}h||O().catch(P)}catch(e){P(e)}}function L(){if(!g)for(C("send parts","activeUploads",f,"partsToUpload",p.length);f<eu&&p.length>0;){let e=p.shift();e&&N(e)}}function P(e){g||(g=!0,i.abort(),m.releaseLock(),e instanceof TypeError&&("Failed to fetch"===e.message||"fetch failed"===e.message)?u(new Q):u(e))}a.onUploadProgress&&(c=b(()=>{var e;let t=Object.values(E).reduce((e,t)=>e+t,0),r=s||t,o=s>0?Number((100*(t/s||t)).toFixed(2)):0;null==(e=a.onUploadProgress)||e.call(a,{loaded:t,total:r,percentage:o})},150)),O().catch(P)})}({uploadId:a.uploadId,key:a.key,pathname:e,stream:i,headers:r,options:o,totalToLoad:s});return await es({uploadId:a.uploadId,key:a.key,pathname:e,parts:l,headers:r,options:n})}var ed=function({allowedOptions:e,getToken:t,extraChecks:r}){return async function(o,n,a){if(!n)throw new R("body is required");if(function(e){if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}(n))throw new R("Body must be a string, buffer or stream. You sent a plain JavaScript object, double check what you're trying to upload.");let s=await ea({pathname:o,options:a,extraChecks:r,getToken:t}),i=function(e,t){let r={};return e.includes("contentType")&&t.contentType&&(r[en.contentType]=t.contentType),e.includes("addRandomSuffix")&&void 0!==t.addRandomSuffix&&(r[en.addRandomSuffix]=t.addRandomSuffix?"1":"0"),e.includes("allowOverwrite")&&void 0!==t.allowOverwrite&&(r[en.allowOverwrite]=t.allowOverwrite?"1":"0"),e.includes("cacheControlMaxAge")&&void 0!==t.cacheControlMaxAge&&(r[en.cacheControlMaxAge]=t.cacheControlMaxAge.toString()),r}(e,s);if(!0===s.multipart)return ep(o,n,i,s);let l=s.onUploadProgress?b(s.onUploadProgress,100):void 0,u=new URLSearchParams({pathname:o}),c=await eo(`/?${u.toString()}`,{method:"PUT",body:n,headers:i,signal:s.abortSignal},{...s,onUploadProgress:l});return{url:c.url,downloadUrl:c.downloadUrl,pathname:c.pathname,contentType:c.contentType,contentDisposition:c.contentDisposition}}}({allowedOptions:["cacheControlMaxAge","addRandomSuffix","allowOverwrite","contentType"]});async function em(e){try{let t=await (0,p.getServerSession)(d.L);if(!t||!t.user?.id)return c.NextResponse.json({error:"Unauthorized"},{status:401});let r=(await e.formData()).get("file");if(!r)return c.NextResponse.json({error:"No file uploaded"},{status:400});if(!["image/jpeg","image/png","image/gif","image/webp"].includes(r.type))return c.NextResponse.json({error:"Invalid file type. Only JPG, PNG, GIF, and WebP are allowed."},{status:400});if(r.size>5242880)return c.NextResponse.json({error:"File too large. Maximum size is 5MB."},{status:400});let o=Date.now(),n=Math.random().toString(36).substring(7),a=r.name.split(".").pop()||"jpg",s=`posts/${t.user.id}/${o}-${n}.${a}`;try{if("demo-token-replace-with-real-vercel-blob-token"===process.env.BLOB_READ_WRITE_TOKEN){let e=await r.arrayBuffer(),t=Buffer.from(e).toString("base64"),o=`data:${r.type};base64,${t}`;return console.log("\uD83D\uDDBCï¸ Image upload debug:"),console.log("- File name:",r.name),console.log("- File size:",r.size),console.log("- File type:",r.type),console.log("- Data URL length:",o.length),c.NextResponse.json({url:o,filename:r.name})}let e=await ed(s,r,{access:"public"});return c.NextResponse.json({url:e.url,filename:r.name})}catch(e){return console.error("Upload error:",e),c.NextResponse.json({error:"Failed to upload image"},{status:500})}}catch(e){return console.error("Upload API error:",e),c.NextResponse.json({error:"Internal server error"},{status:500})}}(function({allowedOptions:e,getToken:t,extraChecks:r}){})({allowedOptions:["cacheControlMaxAge","addRandomSuffix","allowOverwrite","contentType"]}),function({allowedOptions:e,getToken:t,extraChecks:r}){}({allowedOptions:["cacheControlMaxAge","addRandomSuffix","allowOverwrite","contentType"]}),function({allowedOptions:e,getToken:t,extraChecks:r}){}({allowedOptions:["cacheControlMaxAge","addRandomSuffix","allowOverwrite","contentType"]}),function({allowedOptions:e,getToken:t,extraChecks:r}){}({allowedOptions:["cacheControlMaxAge","addRandomSuffix","allowOverwrite","contentType"]});let ef=new i.AppRouteRouteModule({definition:{kind:l.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/Users/davidsime/hvna-ecosystem/contentlynk/src/app/api/upload/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:eh,staticGenerationAsyncStorage:ey,serverHooks:eb}=ef,eg="/api/upload/route";function ew(){return(0,u.patchFetch)({serverHooks:eb,staticGenerationAsyncStorage:ey})}},42579:(e,t,r)=>{var o=r(21509);e.exports=function(e,t){return new Promise(function(r,n){var a,s=t||{};function i(e){n(e||Error("Aborted"))}function l(e,t){if(e.bail){i(e);return}a.retry(e)?s.onRetry&&s.onRetry(e,t):n(a.mainError())}"randomize"in s||(s.randomize=!0),(a=o.operation(s)).attempt(function(t){var o;try{o=e(i,t)}catch(e){l(e,t);return}Promise.resolve(o).then(r).catch(function(e){l(e,t)})})})}},40346:e=>{/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},21509:(e,t,r)=>{e.exports=r(85656)},85656:(e,t,r)=>{var o=r(12511);t.operation=function(e){return new o(t.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var o=[],n=0;n<t.retries;n++)o.push(this.createTimeout(n,t));return e&&e.forever&&!o.length&&o.push(this.createTimeout(n,t)),o.sort(function(e,t){return e-t}),o},t.createTimeout=function(e,t){return Math.min(Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e)),t.maxTimeout)},t.wrap=function(e,r,o){if(r instanceof Array&&(o=r,r=null),!o)for(var n in o=[],e)"function"==typeof e[n]&&o.push(n);for(var a=0;a<o.length;a++){var s=o[a],i=e[s];e[s]=(function(o){var n=t.operation(r),a=Array.prototype.slice.call(arguments,1),s=a.pop();a.push(function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),s.apply(this,arguments))}),n.attempt(function(){o.apply(e,a)})}).bind(e,i),e[s].options=r}}},12511:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var o=this;return this._timer=setTimeout(function(){o._attempts++,o._operationTimeoutCb&&(o._timeout=setTimeout(function(){o._operationTimeoutCb(o._attempts)},o._operationTimeout),o._options.unref&&o._timeout.unref()),o._fn(o._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,o=0;o<this._errors.length;o++){var n=this._errors[o],a=n.message,s=(e[a]||0)+1;e[a]=s,s>=r&&(t=n,r=s)}return t}},49752:e=>{e.exports=function(e,t){let r;if("function"!=typeof e)throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let o=0;return function(...n){clearTimeout(r);let a=Date.now(),s=t-(a-o);s<=0?(o=a,e.apply(this,n)):r=setTimeout(()=>{o=Date.now(),e.apply(this,n)},s)}}},95456:(e,t,r)=>{"use strict";r.d(t,{L:()=>p});var o=r(13539),n=r(53797),a=r(8194),s=r(42023),i=r.n(s),l=r(91585);let u=l.Ry({email:l.Z_().email(),password:l.Z_().min(6)}),c=l.Ry({email:l.Z_().email(),username:l.Z_().min(3).max(20).regex(/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, underscores, and hyphens"),password:l.Z_().min(6),displayName:l.Z_().optional()}),p={adapter:(0,o.N)(a._),providers:[(0,n.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"},username:{label:"Username",type:"text"},displayName:{label:"Display Name",type:"text"},isRegister:{label:"Is Register",type:"text"}},async authorize(e){if(!e?.email||!e?.password)return null;try{if("true"===e.isRegister){console.log("Registration attempt:",{email:e.email,username:e.username,displayName:e.displayName});let t=c.parse({email:e.email,username:e.username,password:e.password,displayName:e.displayName});console.log("Validation passed:",t);let r=await a._.user.findFirst({where:{OR:[{email:t.email},{username:t.username}]}});if(console.log("Existing user check:",r),r)throw console.log("User already exists:",r.email,r.username),Error("User already exists with this email or username");await i().hash(t.password,12);let o=await a._.user.create({data:{email:t.email,username:t.username,displayName:t.displayName||t.username}});return{id:o.id,email:o.email,username:o.username,displayName:o.displayName||void 0}}{let t=u.parse({email:e.email,password:e.password}),r=await a._.user.findUnique({where:{email:t.email}});if(!r)return null;return{id:r.id,email:r.email,username:r.username,displayName:r.displayName||void 0}}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.username=t.username,e.displayName=t.displayName),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.username=t.username,e.user.displayName=t.displayName),e)},pages:{signIn:"/auth/signin"}}},8194:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});let o=require("@prisma/client"),n=globalThis.prisma??new o.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,834,70],()=>r(22122));module.exports=o})();