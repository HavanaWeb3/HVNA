(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[402],{7929:function(e,t,a){Promise.resolve().then(a.bind(a,7587))},6463:function(e,t,a){"use strict";var r=a(1169);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},7587:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var r=a(7437),s=a(2265),i=a(998),n=a(6463),l=a(4608),o=a(6760);function d(){var e;let{data:t,status:a}=(0,i.useSession)(),d=(0,n.useRouter)(),c=(0,n.useParams)().postId,[u,m]=(0,s.useState)(null),[h,g]=(0,s.useState)(""),[x,p]=(0,s.useState)(""),[f,b]=(0,s.useState)(!1),[v,y]=(0,s.useState)(!0),[j,N]=(0,s.useState)(null),[w,k]=(0,s.useState)(null),[C,P]=(0,s.useState)(!1);(0,s.useEffect)(()=>{"unauthenticated"===a&&d.push("/auth/signin")},[a,d]),(0,s.useEffect)(()=>{var e;(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id)&&c&&S()},[null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id,c]);let S=async()=>{try{var e;y(!0);let a=await fetch("/api/posts?userId=".concat(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id,"&limit=50"));if(a.ok){let{posts:e}=await a.json(),t=e.find(e=>e.id===c);if(!t){alert("Post not found or you do not have permission to edit it."),d.push("/dashboard");return}m(t),g(t.title||""),p(t.content||""),k(t.imageUrl)}else alert("Failed to fetch post"),d.push("/dashboard")}catch(e){console.error("Error fetching post:",e),alert("Failed to fetch post"),d.push("/dashboard")}finally{y(!1)}},F=e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;if(!["image/jpeg","image/png","image/gif","image/webp"].includes(a.type)){alert("Invalid file type. Please select a JPG, PNG, GIF, or WebP image.");return}if(a.size>5242880){alert("File too large. Please select an image under 5MB.");return}N(a);let r=new FileReader;r.onload=e=>{var t;k(null===(t=e.target)||void 0===t?void 0:t.result)},r.readAsDataURL(a)},R=async e=>{e.preventDefault(),b(!0);try{let e=w;if(j){P(!0);let t=new FormData;t.append("file",j);let a=await fetch("/api/upload",{method:"POST",body:t});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to upload image")}let{url:r}=await a.json();e=r,P(!1)}let t=await fetch("/api/posts",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:c,title:h.trim()||null,content:x.trim(),imageUrl:e})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to update post")}alert("Post updated successfully!"),d.push("/dashboard")}catch(e){console.error("Error updating post:",e),alert(e instanceof Error?e.message:"Failed to update post. Please try again.")}finally{b(!1),P(!1)}};return"loading"===a||v?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading post..."})]})}):t&&u?(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Edit Post"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Update your content and continue earning"})]}),(0,r.jsx)(o.z,{variant:"outline",onClick:()=>d.push("/dashboard"),children:"Back to Dashboard"})]})})}),(0,r.jsx)("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{children:[(0,r.jsx)(l.ll,{children:"Edit Your Post"}),(0,r.jsx)(l.SZ,{children:"Make changes to your content"})]}),(0,r.jsx)(l.aY,{children:(0,r.jsxs)("form",{onSubmit:R,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2",children:"Post Title (Optional)"}),(0,r.jsx)("input",{id:"title",type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"Give your post a catchy title...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",maxLength:100}),(0,r.jsx)("div",{className:"flex justify-between items-center mt-1",children:(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[h.length,"/100 characters"]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-2",children:"Content"}),(0,r.jsx)("textarea",{id:"content",value:x,onChange:e=>p(e.target.value),placeholder:"Share your thoughts, ideas, or stories...",rows:8,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 resize-none",maxLength:1e3}),(0,r.jsx)("div",{className:"flex justify-between items-center mt-2",children:(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[x.length,"/1000 characters"]})})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Update Image (Optional)"}),w?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("img",{src:w,alt:"Preview",className:"max-w-full max-h-64 rounded-lg shadow-md mx-auto"}),(0,r.jsx)("button",{type:"button",onClick:()=>{N(null),k(null)},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),j&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 text-center",children:["New image: ",j.name," (",(j.size/1024/1024).toFixed(1),"MB)"]}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)("label",{className:"cursor-pointer text-sm text-indigo-600 hover:text-indigo-500",children:["Change image",(0,r.jsx)("input",{type:"file",className:"hidden",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:F})]})})]}):(0,r.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,r.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("label",{className:"cursor-pointer",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-indigo-600 hover:text-indigo-500",children:"Click to upload new image"}),(0,r.jsx)("input",{type:"file",className:"hidden",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:F})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG, GIF, WebP up to 5MB"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)(o.z,{type:"button",variant:"outline",onClick:()=>d.push("/dashboard"),children:"Cancel"}),(0,r.jsx)(o.z,{type:"submit",disabled:!x.trim()||f||C,className:"bg-indigo-600 hover:bg-indigo-700",children:C?"Uploading Image...":f?"Updating...":"Update Post"})]})]})})]})})]}):null}},6760:function(e,t,a){"use strict";a.d(t,{z:function(){return n}});var r=a(7437),s=a(2265),i=a(9354);let n=s.forwardRef((e,t)=>{let{className:a,variant:s="primary",size:n="md",children:l,...o}=e;return(0,r.jsx)("button",{className:(0,i.cn)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",{primary:"bg-indigo-600 text-white hover:bg-indigo-700 active:bg-indigo-800",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 active:bg-gray-300",outline:"border border-gray-300 bg-transparent text-gray-700 hover:bg-gray-50 active:bg-gray-100",ghost:"bg-transparent text-gray-700 hover:bg-gray-100 active:bg-gray-200"}[s],{sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-base",lg:"h-12 px-6 text-lg"}[n],a),ref:t,...o,children:l})});n.displayName="Button"},4608:function(e,t,a){"use strict";a.d(t,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return n},aY:function(){return c},ll:function(){return o}});var r=a(7437),s=a(2265),i=a(9354);let n=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-white text-gray-950 shadow-sm",a),...n,children:s})});n.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",a),...n,children:s})});l.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",a),...n,children:s})});o.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-gray-500",a),...n,children:s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",a),...n,children:s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",a),...n,children:s})}).displayName="CardFooter"},9354:function(e,t,a){"use strict";a.d(t,{cn:function(){return i}});var r=a(4839),s=a(6164);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}}},function(e){e.O(0,[998,868,971,23,744],function(){return e(e.s=7929)}),_N_E=e.O()}]);